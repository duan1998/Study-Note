## **LuaJIT**

**ARM**有一个限制，就是跳转指令只能跳转前后32MB的空间，故LuaJIT生成的代码必须是在这64MB空间内，如果这个空间被其他东西占用了，LuaJIT就会分配不出用于JIT的内存，而目前LuaJIT会疯狂重复尝试编译，最后导致性能处于瘫痪的状态

------------------------------------------------------

### 转到  **ARM处理器**

目前市面上的CPU分类主要分有两大阵营，一个是intel、AMD为首的复杂指令集CPU，另一个是以IBM、ARM为首的精简指令集CPU。两个不同品牌的CPU，其产品的架构也不相同，例如，Intel、AMD的CPU是X86架构的，而IBM公司的CPU是PowerPC架构，ARM公司是ARM架构

处理器微架构相当于建筑物的设计图，指令集相当于建筑材料。

ARM牛逼的地方就在于它不仅有指令集，还设计处理器架构，比如Cortex-A53/A73（ARM架构）,像三星、MTK、英伟达、海思这些厂商拿到这些架构授权后，只需要选择核心数、总线互联、缓存等就基本完成CPU部分的设计。我们把这种直接使用ARM设计好的内核方案叫做**公版架构（使用层级授权）**。如高通骁龙810，MTK，三星exynos7420，海思等。

ARM的授权方式也就分为指令集架构授权和**IP核授权**。

---

#### 转到  **架构的授权方式**

架构的授权方式有三种：架构层级授权、内核层级授权(ip核授权)、使用层级授权

使用层级授权，要想使用一款处理器，得到使用层级的授权是最基本的，这就意味着你只能拿别人提供的定义好的ip来嵌入在你的设计中，不能更改人家的ip，也不能借助人家的ip创造自己的基于该ip的封装产品（**只能用，不能外包装**

内核层级授权，是指可以以一个内核为基础然后在加上自己的外设，比如USART GPIO SPI ADC 等等，最后形成了自己的MCU，这些很多，比如三星TI（**可以外包装**

架构层级授权，是指可以对ARM架构进行大幅度改造，甚至可以对ARM指令集进行扩展或缩减，苹果就是一个很好的例子，在使用ARMv7-A架构基础上，扩展出了自己的苹果swift架构（**可以魔改**

因此，如果华为分别拿到架构授权和ip核授权，那么意味着它可以在ARM指令集基础上根据需要创建出自己的内核架构，并可添加各种片内外设比如通信接口、显示器控制接口、GPIO等等，从而生产出自己的“处理器芯片”。

**趣事**

高通买的是ARM公司一个IP核的授权，而且从855芯片的图片上我们可以看到，上面有一行字“Build on Arm Cortex Technology”，也就是说它在购买的IP核的基础上进行了大范围的修改。而且高通要求，ARM在提供给它这个核心的时候，按照高通要求进行深度定制，而且高通将这个IP核进行了重新命名，改为为**Kryo**。

华为海思，以麒麟980为例（如图3所示），它购买的同样也是ARM公司IP核的授权，在麒麟980的发布会上我们可以看到，它强调了是Cortex-A76 Based CPU，也就是说它是基于Cortex-A76这个IP核进行了自主修改，但是其修改和定制幅度就要比高通差很多，所以也没有对核心进行重新的命名。





---

#### 转到  **冯诺依曼、哈佛架构**

冯诺依曼理论的要点是：数字计算机的数制采用二进制  计算机应该按照程序顺序执行

冯诺依曼结构：是一种将程序指令存储器和数据存储器合并在一起的存储结构。取指令和取操作数都在同一总线上，通过分时复用的方式进行，在高速时，不能同时取出指令和操作数，并因是存在同一存储结构，程序指令和数据的宽度一致

![image-20200805150004289](C:\Users\XINDONG\AppData\Roaming\Typora\typora-user-images\image-20200805150004289.png)

哈佛结构：将程序指令存储和数据存储分开的存储器结构，每个存储器独立编址，独立访问，目的减轻程序运行时的访存瓶颈。哈佛结构的中央处理器**首先**到程序指令储存器中读取程序指令内容，**解码后**得到数据地址，再到相应的数据储存器中**读取数据**，并进行下一步的操作（通常是执行）

![image-20200805150206785](C:\Users\XINDONG\AppData\Roaming\Typora\typora-user-images\image-20200805150206785.png)

改进型哈佛结构：把两个存储器的地址总线合并了，数据总线也进行了合并，即原来的哈佛结构需要４条不同的总线，改进后需要两条总线，两条总线由程序存储器和数据存储器分时共用。

![image-20200805150356589](C:\Users\XINDONG\AppData\Roaming\Typora\typora-user-images\image-20200805150356589.png)



